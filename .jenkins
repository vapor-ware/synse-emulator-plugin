#!/usr/bin/env groovy

pipeline {

  agent any

  environment {
    PROJ_PATH = '/go/src/github.com/vapor-ware/synse-emulator-plugin'
    IMAGE_NAME = 'vaporio/emulator-plugin'
    GOPATH = $JOBDIR

  }

  stages {
    stage('Checkout') {
      steps {
        checkout scm
      }
    }

    stage('Lint') {
      steps {
        script {
          docker.image('vaporio/golang:1.11').inside() {
            sh 'mkdir -p ${PROJ_PATH} && ln -s ${WORKSPACE} ${PROJ_PATH}'
            sh 'go get -u github.com/alecthomas/gometalinter'
            sh 'gometalinter --install'
            sh 'gometalinter ./... --disable=gotype --tests --vendor --sort=path --sort=line --aggregate --deadline=5m -e $$(go env GOROOT)'
          }
        }
      }
    }
  }
}
